<?xml version="1.0"?>
<!-- vim:set sw=2 ts=2 et: -->
<ruleset name="Mike's Coding Standard">

  <description>Mike's coding standard for php 7.4+</description>

  <arg name="basepath" value="." />
  <!-- NOTE this can only be declared once!! if you do it multiple times it will override the previous one. comma-delimited. -->
  <!-- <config name="installed_paths" value="/Users/mikefunk/Code/bookymark/vendor/slevomat/coding-standard" /> -->

  <!-- ensure php code is compatible with this version -->
  <config name="testVersion" value="7.4.7" />

  <arg name="extensions" value="php" />
  <arg name="colors" />
  <ini name="memory_limit" value="1024M"/>

  <exclude-pattern>vendor/*</exclude-pattern>
  <exclude-pattern>tests/*</exclude-pattern>
  <exclude-pattern>spec/*</exclude-pattern>
  <exclude-pattern>coverage/*</exclude-pattern>
  <exclude-pattern>resources/views*</exclude-pattern>
  <exclude-pattern>bootstrap/cache</exclude-pattern>
  <exclude-pattern>composer.phar</exclude-pattern>
  <exclude-pattern>tags</exclude-pattern>
  <exclude-pattern>_ide_helper.php</exclude-pattern>
  <exclude-pattern>storage/*</exclude-pattern>

  <!-- Generic -->
  <rule ref="Generic">
    <exclude name="Generic.Arrays.DisallowShortArraySyntax" />
    <exclude name="Generic.Classes.OpeningBraceSameLine" />
    <exclude name="Generic.CodeAnalysis.EmptyStatement.DetectedCatch" />
    <exclude name="Generic.Commenting.DocComment" />
    <exclude name="Generic.Commenting.Todo" />
    <exclude name="Generic.Files.EndFileNoNewline" />
    <exclude name="Generic.Files.LowercasedFilename" />
    <exclude name="Generic.Formatting.MultipleStatementAlignment" />
    <exclude name="Generic.Formatting.NoSpaceAfterCast" />
    <exclude name="Generic.Formatting.SpaceAfterNot" />
    <exclude name="Generic.Formatting.SpaceBeforeCast" />
    <exclude name="Generic.Functions.FunctionCallArgumentSpacing.NoSpaceAfterComma" />
    <exclude name="Generic.Functions.OpeningFunctionBraceBsdAllman" />
    <exclude name="Generic.Functions.OpeningFunctionBraceKernighanRitchie" />
    <exclude name="Generic.PHP.ClosingPHPTag" />
    <exclude name="Generic.PHP.UpperCaseConstant" />
    <exclude name="Generic.WhiteSpace.DisallowSpaceIndent" />
    <!-- overlaps with slevomat which is fixable -->
    <exclude name="Generic.PHP.RequireStrictTypes.MissingDeclaration" />
    <exclude name="SlevomatCodingStandard.Numbers.DisallowNumericLiteralSeparator" />
  </rule>

  <rule ref="Generic.Formatting.SpaceAfterNot">
    <properties>
      <property name="spacing" value="0" />
    </properties>
  </rule>

  <rule ref="Generic.Strings.UnnecessaryStringConcat">
    <properties>
      <property name="allowMultiline" value="true" />
      <!-- warning instead of error -->
      <property name="error" value="false" />
    </properties>
  </rule>

  <rule ref="Generic.PHP.ForbiddenFunctions">
    <properties>
      <!-- warning instead of error -->
      <property name="error" value="false" />
    </properties>
  </rule>

  <rule ref="Generic.NamingConventions.CamelCapsFunctionName.ScopeNotCamelCaps">
    <exclude-pattern>spec/*</exclude-pattern>
  </rule>

  <!-- MySource -->
  <rule ref="MySource">

    <rule ref="Squiz.Strings.ConcatenationSpacing">
      <properties>
        <property name="ignoreNewlines" value="true" />
        <property name="spacing" value="1" />
      </properties>
    </rule>

    <exclude name="MySource.CSS.BrowserSpecificStyles" />
    <exclude name="MySource.Channels.DisallowSelfActions" />
    <exclude name="MySource.Channels.IncludeOwnSystem" />
    <exclude name="MySource.Channels.IncludeSystem" />
    <exclude name="MySource.Channels.UnusedSystem" />
    <exclude name="MySource.Commenting.FunctionComment" />
    <exclude name="MySource.Debug.DebugCode" />
    <exclude name="MySource.Debug.FirebugConsole" />
    <exclude name="MySource.Objects.AssignThis" />
    <exclude name="MySource.Objects.CreateWidgetTypeCallback" />
    <exclude name="MySource.Objects.DisallowNewWidget" />
    <exclude name="MySource.PHP.ReturnFunctionValue.NotAssigned" />
    <exclude name="MySource.Strings.JoinStrings" />
  </rule>

  <!-- PEAR -->
  <rule ref="PEAR">
    <exclude name="PEAR.Functions.FunctionCallSignature" />
    <exclude name="PEAR.NamingConventions.ValidVariableName" />
    <exclude name="PEAR.NamingConventions.ValidFunctionName" />
    <exclude name="Generic.Files.LineLength" />
    <exclude name="PEAR.Commenting.FileComment" />
    <exclude name="PEAR.Commenting.ClassComment" />
    <exclude name="PEAR.Commenting.FunctionComment" />
    <exclude name="PEAR.WhiteSpace.ObjectOperatorIndent" />
    <exclude name="PEAR.WhiteSpace.ScopeIndent" />
    <exclude name="PEAR.Functions.FunctionCallSignature.ContentAfterOpenBracket" />
    <exclude name="PEAR.Functions.FunctionCallSignature.CloseBracketLine" />
    <exclude name="PEAR.Formatting.MultiLineAssignment.EqualSignLine" />
    <exclude name="PEAR.Files.IncludingFile" />
  </rule>

  <!-- PSR1 -->
  <rule ref="PSR1">
  </rule>

  <rule ref="PSR1.Classes.ClassDeclaration.MissingNamespace">
    <exclude-pattern>./database/migrations</exclude-pattern>
  </rule>

  <rule ref="PSR1.Methods.CamelCapsMethodName.NotCamelCaps">
    <exclude-pattern>spec/*</exclude-pattern>
  </rule>

  <!-- PSR2 -->
  <rule ref="PSR2" />

  <!-- PSR12 -->
  <rule ref="PSR12" />

  <!-- Squiz -->
  <rule ref="Squiz">
    <exclude name="Squiz.PHP.DisallowMultipleAssignments" />
    <exclude name="Squiz.PHP.DisallowBooleanStatement" />
    <exclude name="Squiz.WhiteSpace.MemberVarSpacing" />
    <!-- this is a great rule but it doesn't respect {@inheritDoc} :( -->
    <!-- <exclude name="Squiz.Commenting.FunctionCommentThrowTag.Missing" /> -->
    <!-- <exclude name="Squiz.PHP.CommentedOutCode" /> -->
    <exclude name="Squiz.Strings.DoubleQuoteUsage" />
    <exclude name="Squiz.Commenting.LongConditionClosingComment" />
    <exclude name="Squiz.Commenting.PostStatementComment.Found" />
    <exclude name="Squiz.Commenting.VariableComment" />
    <exclude name="Squiz.Commenting.BlockComment" />
    <exclude name="Squiz.Commenting.ClassComment" />
    <exclude name="Squiz.Files.FileExtension" />
    <exclude name="Squiz.Commenting.FileComment" />
    <exclude name="Squiz.Operators.ComparisonOperatorUsage" />
    <exclude name="Squiz.PHP.DisallowInlineIf" />
    <exclude name="Squiz.PHP.DisallowComparisonAssignment" />
    <exclude name="Squiz.WhiteSpace.ObjectOperatorSpacing" />
    <exclude name="Squiz.ControlStructures.InlineIfDeclaration" />
    <exclude name="Squiz.ControlStructures.SwitchDeclaration.BreakIndent" />
    <exclude name="Generic.ControlStructures.DisallowYodaConditions" />
    <exclude name="Squiz.Commenting.InlineComment" />
    <exclude name="Squiz.Arrays.ArrayDeclaration" />
    <exclude name="Squiz.Objects.ObjectInstantiation" />
    <exclude name="Squiz.Commenting.ClosingDeclarationComment" />
    <exclude name="Squiz.Commenting.FunctionComment" />
    <!-- this conflicts with Mike's multiline ternary style -->
    <exclude name="Squiz.WhiteSpace.FunctionClosingBraceSpace.SpacingBeforeClose" />
    <!-- this doesn't take into account ?? >:( -->
    <exclude name="Squiz.Formatting.OperatorBracket" />
    <exclude name="Squiz.ControlStructures.ElseIfDeclaration" />
    <!-- this rule does not allow even \stdClass->my_var, which is fine -->
    <exclude name="Squiz.NamingConventions.ValidVariableName.NotCamelCaps" />
  </rule>

  <rule ref="Squiz.Classes.ClassFileName.NoMatch">
    <exclude-pattern>./database/migrations</exclude-pattern>
  </rule>

  <rule ref="Squiz.WhiteSpace.MemberVarSpacing">
    <properties>
      <property name="spacingBeforeFirst" value="0" />
    </properties>
  </rule>

  <!-- phpspec uses it_does_this() format for functions -->
  <rule ref="Squiz.NamingConventions.ValidFunctionName.ScopeNotCamelCaps">
    <exclude-pattern>spec/*</exclude-pattern>
  </rule>

  <rule ref="Squiz.WhiteSpace.FunctionSpacing">
    <properties>
      <property name="spacing" value="1" />
      <property name="spacingBeforeFirst" value="0" />
      <property name="spacingAfterLast" value="0" />
    </properties>
  </rule>

  <rule ref="Squiz.Strings.ConcatenationSpacing">
    <properties>
      <property name="ignoreNewlines" value="true" />
      <property name="spacing" value="1" />
    </properties>
  </rule>

  <rule ref="Squiz.WhiteSpace.ObjectOperatorSpacing">
    <properties>
      <property name="ignoreNewlines" value="true" />
    </properties>
  </rule>

  <rule ref="Squiz.WhiteSpace.OperatorSpacing">
    <properties>
      <property name="ignoreNewlines" value="true" />
    </properties>
  </rule>

  <!-- Zend -->
  <rule ref="Zend">
    <exclude name="Zend.NamingConventions.ValidVariableName" />
    <exclude name="Zend.Debug.CodeAnalyzer" />
  </rule>

  <!-- Slevomat Coding Standard -->
  <rule ref="SlevomatCodingStandard">
    <exclude name="SlevomatCodingStandard.Namespaces.UseOnlyWhitelistedNamespaces" />
    <exclude name="SlevomatCodingStandard.Namespaces.ReferenceUsedNamesOnly" />
    <exclude name="SlevomatCodingStandard.Commenting.DisallowCommentAfterCode" />
    <exclude name="SlevomatCodingStandard.TypeHints.DisallowMixedTypeHint" />
    <exclude name="SlevomatCodingStandard.Files.TypeNameMatchesFileName" />
    <exclude name="SlevomatCodingStandard.ControlStructures.DisallowEmpty" />
    <exclude name="SlevomatCodingStandard.ControlStructures.DisallowShortTernaryOperator" />
    <exclude name="SlevomatCodingStandard.Functions.DisallowArrowFunction" />
    <exclude name="SlevomatCodingStandard.ControlStructures.RequireYodaComparison.RequiredYodaComparison" />
  </rule>

  <rule ref="SlevomatCodingStandard.Namespaces.ReferenceUsedNamesOnly">
    <properties>
      <property name="allowFullyQualifiedGlobalConstants" value="true" />
      <property name="allowFullyQualifiedGlobalFunctions" value="true" />
    </properties>
  </rule>

  <rule ref="SlevomatCodingStandard.TypeHints.DeclareStrictTypes">
    <properties>
      <property name="newlinesCountBetweenOpenTagAndDeclare" value="2" />
      <property name="newlinesCountAfterDeclare" value = "2" />
      <property name="spacesCountAroundEqualsSign" value = "0" />
    </properties>
  </rule>

  <!-- I can't get this to work -->
  <!-- <rule ref="SlevomatCodingStandard.Files.TypeNameMatchesFileName"> -->
  <!--   <property name="rootNamespaces" type="array"> -->
  <!--     <element key="src" value="" /> -->
  <!--   </property> -->
  <!-- </rule> -->

  <rule ref="SlevomatCodingStandard.Classes.EmptyLinesAroundClassBraces">
    <properties>
      <property name="linesCountAfterOpeningBrace" value="0" />
      <property name="linesCountBeforeClosingBrace" value = "0" />
    </properties>
  </rule>

  <rule ref="SlevomatCodingStandard.Classes.TraitUseSpacing">
    <properties>
      <property name="linesCountBeforeFirstUse" value = "0" />
    </properties>
  </rule>

  <rule ref="SlevomatCodingStandard.TypeHints.ParameterTypeHint">
    <exclude-pattern>./src/Bookymark/Http/Middleware/Authenticate.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Http/Middleware/RedirectIfAuthenticated.php</exclude-pattern>
  </rule>

  <rule ref="SlevomatCodingStandard.TypeHints.ReturnTypeHint">
    <exclude-pattern>./src/Bookymark/Http/Middleware/Authenticate.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Console/Kernel.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Http/Kernel.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Http/Middleware/TrustHosts.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Exceptions/Handler.php</exclude-pattern>
  </rule>

  <rule ref="SlevomatCodingStandard.Commenting.DocCommentSpacing">
    <properties>
      <property name="linesCountBeforeFirstContent" value="0" />
      <property name="linesCountBetweenDescriptionAndAnnotations" value="1" />
      <property name="linesCountBetweenDifferentAnnotationsTypes" value="1" />
      <property name="linesCountAfterLastContent" value="0" />
    </properties>
  </rule>

  <rule ref="SlevomatCodingStandard.TypeHints.PropertyTypeHint">
    <exclude-pattern>./src/Bookymark/Http/Middleware/TrustProxies.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Console/Kernel.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Http/Middleware/EncryptCookies.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Http/Middleware/PreventRequestsDuringMaintenance.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Http/Middleware/TrimStrings.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Http/Middleware/VerifyCsrfToken.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Http/Kernel.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Exceptions/Handler.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Models/User.php</exclude-pattern>
    <exclude-pattern>./src/Bookymark/Providers/AuthServiceProvider.php</exclude-pattern>
  </rule>

  <rule ref="SlevomatCodingStandard.ControlStructures.RequireMultiLineTernaryOperator">
    <properties>
      <property name="lineLengthLimit" value="80" />
    </properties>
  </rule>

  <rule ref="SlevomatCodingStandard.Classes.ClassMemberSpacing">
    <exclude-pattern>./src/Bookymark/Providers/RouteServiceProvider.php</exclude-pattern>
  </rule>

  <rule ref="SlevomatCodingStandard.Functions.ArrowFunctionDeclaration">
    <properties>
      <property name="allowMultiLine" value="true" />
    </properties>
  </rule>

  <rule ref="SlevomatCodingStandard.Functions.StaticClosure">
    <exclude-pattern>./routes/*.php</exclude-pattern>
    <exclude-pattern>./database/migrations</exclude-pattern>
  </rule>

  <rule ref="SlevomatCodingStandard.Variables.DisallowSuperGlobalVariable">
    <exclude-pattern>./bootstrap/app.php</exclude-pattern>
    <exclude-pattern>./server.php</exclude-pattern>
  </rule>

  <rule ref="SlevomatCodingStandard.Functions.RequireSingleLineCall">
    <properties>
      <property name="maxLineLength" value="80" />
    </properties>
  </rule>

</ruleset>
